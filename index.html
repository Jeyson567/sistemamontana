<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Unificado - Hotel, Cocina y Bar</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(120deg, #e0eafc, #cfdef3);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        h1 {
            color: #2c3e50;
            margin-top: 32px;
            text-align: center;
            text-shadow: 0 2px 8px #ccc;
        }
        .area-menu {
            display: flex;
            gap: 32px;
            justify-content: center;
            margin: 32px 0;
        }
        .area-btn {
            background: #3498db;
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 32px 48px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 2px 8px #bbb;
            transition: background 0.2s, transform 0.2s;
        }
        .area-btn:hover {
            background: #217dbb;
            transform: scale(1.05);
        }
        .modulo {
            display: none;
            max-width: 900px;
            margin: 0 auto 40px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 16px #3333;
            padding: 32px;
        }
        .volver-btn {
            background: #e67e22;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 24px;
        }
        .volver-btn:hover {
            background: #b95c00;
        }
        /* Reutiliza estilos de hotel.html para tablas y botones */
        table {
            border-collapse: collapse;
            width: 100%;
            background: #fff;
            box-shadow: 0 2px 8px #ccc;
        }
        th, td {
            border: 1px solid #e1e1e1;
            padding: 10px;
            text-align: center;
        }
        th {
            background: #34495e;
            color: #fff;
        }
        .reservada {
            background: #ffe0e0;
        }
        .disponible {
            background: #e0ffe0;
        }
    </style>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Sistema Unificado</h1>
    <div class="area-menu" id="areaMenu">
    <!-- <button class="area-btn" onclick="mostrarModulo('hotel')">Hotel / Recepción</button> -->
        <button class="area-btn" onclick="mostrarModulo('cocina')">Cocina</button>
        <button class="area-btn" onclick="mostrarModulo('bar')">Bar</button>
    </div>

    <!-- Hotel / Recepción eliminado -->

    <!-- Cocina -->
    <div class="modulo" id="moduloCocina">
        <button class="volver-btn" onclick="volverMenu()">Volver al menú</button>
        <h2>Inventario de Cocina</h2>
        <div class="container" style="box-shadow:none;padding:0;max-width:100%;">
            <div id="lowStockAlertCocina"></div>
            <form id="addFormCocina">
                <h3>Ingreso de Producto</h3>
                <label>Nombre del producto</label>
                <input type="text" id="addNameCocina" required>
                <label>Cantidad</label>
                <input type="number" id="addQtyCocina" min="1" required>
                <button type="submit">Ingresar</button>
            </form>
            <form id="sellFormCocina">
                <h3>Venta de Producto</h3>
                <label>Producto</label>
                <select id="sellNameCocina"></select>
                <label>Cantidad a vender</label>
                <input type="number" id="sellQtyCocina" min="1" required>
                <button type="submit">Vender</button>
            </form>
            <h3>Informe de Inventario</h3>
            <table id="inventoryTableCocina">
                <thead>
                    <tr><th>Producto</th><th>Cantidad</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <button id="clearAllCocina" style="background:#e74c3c;margin-top:18px;">Borrar todo</button>
            <button id="pdfVentasCocina" style="background:#27ae60;margin-top:18px;">Descargar informe de ventas de hoy (PDF)</button>
        </div>
    </div>

    <!-- Bar -->
    <div class="modulo" id="moduloBar">
        <button class="volver-btn" onclick="volverMenu()">Volver al menú</button>
        <h2>Inventario de Bar</h2>
        <div class="container" style="box-shadow:none;padding:0;max-width:100%;">
            <div id="lowStockAlertBar"></div>
            <form id="addFormBar">
                <h3>Ingreso de Producto</h3>
                <label>Nombre del producto</label>
                <input type="text" id="addNameBar" required>
                <label>Cantidad</label>
                <input type="number" id="addQtyBar" min="1" required>
                <button type="submit">Ingresar</button>
            </form>
            <form id="sellFormBar">
                <h3>Venta de Producto</h3>
                <label>Producto</label>
                <select id="sellNameBar"></select>
                <label>Cantidad a vender</label>
                <input type="number" id="sellQtyBar" min="1" required>
                <button type="submit">Vender</button>
            </form>
            <h3>Informe de Inventario</h3>
            <table id="inventoryTableBar">
                <thead>
                    <tr><th>Producto</th><th>Cantidad</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <button id="clearAllBar" style="background:#e74c3c;margin-top:18px;">Borrar todo</button>
            <button id="pdfVentasBar" style="background:#27ae60;margin-top:18px;">Descargar informe de ventas de hoy (PDF)</button>
        </div>
    </div>

    <script>
    // Menú principal y navegación
    function mostrarModulo(area) {
        document.getElementById('areaMenu').style.display = 'none';
        document.getElementById('moduloCocina').style.display = 'none';
        document.getElementById('moduloBar').style.display = 'none';
        if(area === 'cocina') document.getElementById('moduloCocina').style.display = 'block';
        if(area === 'bar') document.getElementById('moduloBar').style.display = 'block';
    }
    function volverMenu() {
        document.getElementById('areaMenu').style.display = 'flex';
        document.getElementById('moduloCocina').style.display = 'none';
        document.getElementById('moduloBar').style.display = 'none';
    }

    // --- Lógica módulo Hotel eliminada ---

    // --- Lógica módulo Cocina ---
    let inventarioCocina = [];
    let ventasCocina = [];
    const lowStockLimitCocina = 5;
    function cargarDatosCocina() {
        try {
            inventarioCocina = JSON.parse(localStorage.getItem('inventario_cocina')) || [];
        } catch(e) { inventarioCocina = []; }
        try {
            ventasCocina = JSON.parse(localStorage.getItem('ventas_cocina')) || [];
        } catch(e) { ventasCocina = []; }
    }
    function guardarInventarioCocina() {
        localStorage.setItem('inventario_cocina', JSON.stringify(inventarioCocina));
    }
    function guardarVentasCocina() {
        localStorage.setItem('ventas_cocina', JSON.stringify(ventasCocina));
    }
    function actualizarTablaCocina() {
        const tbody = document.querySelector('#inventoryTableCocina tbody');
        tbody.innerHTML = '';
        inventarioCocina.forEach(item => {
            const tr = document.createElement('tr');
            if (item.cantidad <= lowStockLimitCocina) tr.classList.add('low-stock');
            tr.innerHTML = `<td>${item.nombre}</td><td>${item.cantidad}</td>`;
            tbody.appendChild(tr);
        });
        guardarInventarioCocina();
    }
    function actualizarSelectCocina() {
        const select = document.getElementById('sellNameCocina');
        select.innerHTML = '';
        inventarioCocina.forEach(item => {
            const option = document.createElement('option');
            option.value = item.nombre;
            option.textContent = item.nombre;
            select.appendChild(option);
        });
    }
    function mostrarAlertaStockBajoCocina() {
        const alertDiv = document.getElementById('lowStockAlertCocina');
        const bajos = inventarioCocina.filter(item => item.cantidad <= lowStockLimitCocina);
        if (bajos.length > 0) {
            alertDiv.innerHTML = `<div class='alert'>¡Stock bajo en: ${bajos.map(i => i.nombre).join(', ')}!</div>`;
        } else {
            alertDiv.innerHTML = '';
        }
    }
    document.getElementById('addFormCocina').onsubmit = function(e) {
        e.preventDefault();
        const nombre = document.getElementById('addNameCocina').value.trim();
        const cantidad = parseInt(document.getElementById('addQtyCocina').value);
        if (!nombre || cantidad < 1) return;
        let prod = inventarioCocina.find(i => i.nombre === nombre);
        if (prod) {
            prod.cantidad += cantidad;
        } else {
            inventarioCocina.push({ nombre, cantidad });
        }
        actualizarTablaCocina();
        actualizarSelectCocina();
        mostrarAlertaStockBajoCocina();
        this.reset();
    };
    document.getElementById('sellFormCocina').onsubmit = function(e) {
        e.preventDefault();
        const nombre = document.getElementById('sellNameCocina').value;
        const cantidad = parseInt(document.getElementById('sellQtyCocina').value);
        let prod = inventarioCocina.find(i => i.nombre === nombre);
        if (!prod || cantidad < 1 || cantidad > prod.cantidad) {
            alert('Cantidad inválida o producto sin stock suficiente.');
            return;
        }
        prod.cantidad -= cantidad;
        ventasCocina.push({
            nombre,
            cantidad,
            fecha: new Date().toISOString()
        });
        guardarInventarioCocina();
        guardarVentasCocina();
        actualizarTablaCocina();
        mostrarAlertaStockBajoCocina();
        this.reset();
    };
    document.getElementById('clearAllCocina').onclick = function() {
        if (confirm('¿Seguro que quieres borrar todo el inventario?')) {
            inventarioCocina = [];
            ventasCocina = [];
            guardarInventarioCocina();
            guardarVentasCocina();
            actualizarTablaCocina();
            actualizarSelectCocina();
            mostrarAlertaStockBajoCocina();
        }
    };
    document.getElementById('pdfVentasCocina').onclick = function() {
        generarPDFVentasHoyCocina();
    };
    function generarPDFVentasHoyCocina() {
        const hoy = new Date().toISOString().slice(0,10);
        const ventasHoy = ventasCocina.filter(v => v.fecha.slice(0,10) === hoy);
        if (ventasHoy.length === 0) {
            alert('No hay ventas registradas hoy.');
            return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text('Informe de ventas - ' + hoy, 10, 15);
        doc.setFontSize(12);
        let y = 30;
        doc.text('Producto', 10, y);
        doc.text('Cantidad', 80, y);
        doc.text('Hora', 130, y);
        y += 8;
        ventasHoy.forEach(v => {
            doc.text(v.nombre, 10, y);
            doc.text(String(v.cantidad), 80, y);
            doc.text(new Date(v.fecha).toLocaleTimeString(), 130, y);
            y += 8;
        });
        doc.save('ventas_cocina_' + hoy + '.pdf');
    }
    function programarPDFAutomaticoCocina() {
        function checkHora() {
            const ahora = new Date();
            if (ahora.getHours() === 21 && ahora.getMinutes() === 0) {
                generarPDFVentasHoyCocina();
            }
        }
        setInterval(checkHora, 60000);
    }
    cargarDatosCocina();
    actualizarTablaCocina();
    actualizarSelectCocina();
    mostrarAlertaStockBajoCocina();
    programarPDFAutomaticoCocina();

    // --- Lógica módulo Bar ---
    let inventarioBar = [];
    let ventasBar = [];
    const lowStockLimitBar = 5;
    function cargarDatosBar() {
        try {
            inventarioBar = JSON.parse(localStorage.getItem('inventario_bar')) || [];
        } catch(e) { inventarioBar = []; }
        try {
            ventasBar = JSON.parse(localStorage.getItem('ventas_bar')) || [];
        } catch(e) { ventasBar = []; }
    }
    function guardarInventarioBar() {
        localStorage.setItem('inventario_bar', JSON.stringify(inventarioBar));
    }
    function guardarVentasBar() {
        localStorage.setItem('ventas_bar', JSON.stringify(ventasBar));
    }
    function actualizarTablaBar() {
        const tbody = document.querySelector('#inventoryTableBar tbody');
        tbody.innerHTML = '';
        inventarioBar.forEach(item => {
            const tr = document.createElement('tr');
            if (item.cantidad <= lowStockLimitBar) tr.classList.add('low-stock');
            // Mostrar nombre con primera letra mayúscula
            tr.innerHTML = `<td>${item.nombre.charAt(0).toUpperCase() + item.nombre.slice(1)}</td><td>${item.cantidad}</td>`;
            tbody.appendChild(tr);
        });
        guardarInventarioBar();
    }
    function actualizarSelectBar() {
        const select = document.getElementById('sellNameBar');
        select.innerHTML = '';
        if (inventarioBar.length === 0) {
            const option = document.createElement('option');
            option.value = '';
            option.textContent = 'Sin productos';
            select.appendChild(option);
            return;
        }
        inventarioBar.forEach(item => {
            const option = document.createElement('option');
            option.value = item.nombre;
            option.textContent = item.nombre.charAt(0).toUpperCase() + item.nombre.slice(1);
            select.appendChild(option);
        });
    }
    function mostrarAlertaStockBajoBar() {
        const alertDiv = document.getElementById('lowStockAlertBar');
        const bajos = inventarioBar.filter(item => item.cantidad <= lowStockLimitBar);
        if (bajos.length > 0) {
            alertDiv.innerHTML = `<div class='alert'>¡Stock bajo en: ${bajos.map(i => i.nombre).join(', ')}!</div>`;
        } else {
            alertDiv.innerHTML = '';
        }
    }
    document.getElementById('addFormBar').onsubmit = function(e) {
        e.preventDefault();
        let nombre = document.getElementById('addNameBar').value.trim();
        const cantidad = parseInt(document.getElementById('addQtyBar').value);
        if (!nombre || isNaN(cantidad) || cantidad < 1) return;
        nombre = nombre.toLowerCase(); // Normaliza nombre
        let prod = inventarioBar.find(i => i.nombre === nombre);
        if (prod) {
            prod.cantidad += cantidad;
        } else {
            inventarioBar.push({ nombre, cantidad });
        }
        actualizarTablaBar();
        actualizarSelectBar();
        mostrarAlertaStockBajoBar();
        this.reset();
    };

    document.getElementById('sellFormBar').onsubmit = function(e) {
        e.preventDefault();
        let nombre = document.getElementById('sellNameBar').value;
        const cantidad = parseInt(document.getElementById('sellQtyBar').value);
        if (!nombre || isNaN(cantidad) || cantidad < 1) {
            alert('Datos de venta inválidos.');
            return;
        }
        nombre = nombre.toLowerCase(); // Normaliza nombre
        let prod = inventarioBar.find(i => i.nombre === nombre);
        if (!prod || cantidad > prod.cantidad) {
            alert('Cantidad inválida o producto sin stock suficiente.');
            return;
        }
        prod.cantidad -= cantidad;
        ventasBar.push({
            nombre,
            cantidad,
            fecha: new Date().toISOString()
        });
        try {
            guardarInventarioBar();
            guardarVentasBar();
        } catch (err) {
            alert('Error guardando la venta. Intenta de nuevo.');
        }
        actualizarTablaBar();
        mostrarAlertaStockBajoBar();
        this.reset();
    };

    document.getElementById('clearAllBar').onclick = function() {
        if (confirm('¿Seguro que quieres borrar todo el inventario?')) {
            inventarioBar = [];
            ventasBar = [];
            guardarInventarioBar();
            guardarVentasBar();
            actualizarTablaBar();
            actualizarSelectBar();
            mostrarAlertaStockBajoBar();
        }
    };

    document.getElementById('pdfVentasBar').onclick = function() {
        generarPDFVentasHoyBar();
    };
    function generarPDFVentasHoyBar() {
        const hoy = new Date().toISOString().slice(0,10);
        // Agrupar ventas por producto
        const ventasHoy = ventasBar.filter(v => v.fecha && v.fecha.slice(0,10) === hoy);
        if (ventasHoy.length === 0) {
            alert('No hay ventas registradas hoy.');
            return;
        }
        // Resumen por producto
        const resumen = {};
        ventasHoy.forEach(v => {
            if (!resumen[v.nombre]) resumen[v.nombre] = 0;
            resumen[v.nombre] += v.cantidad;
        });
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text('Informe de ventas - ' + hoy, 10, 15);
        doc.setFontSize(12);
        let y = 30;
        doc.text('Producto', 10, y);
        doc.text('Cantidad', 80, y);
        doc.text('Hora', 130, y);
        y += 8;
        ventasHoy.forEach(v => {
            doc.text(v.nombre.charAt(0).toUpperCase() + v.nombre.slice(1), 10, y);
            doc.text(String(v.cantidad), 80, y);
            doc.text(new Date(v.fecha).toLocaleTimeString(), 130, y);
            y += 8;
        });
        y += 8;
        doc.setFontSize(13);
        doc.text('Resumen total por producto:', 10, y);
        y += 8;
        Object.entries(resumen).forEach(([nombre, total]) => {
            doc.text(`${nombre.charAt(0).toUpperCase() + nombre.slice(1)}: ${total}`, 15, y);
            y += 7;
        });
        doc.save('ventas_bar_' + hoy + '.pdf');
    }
    function programarPDFAutomaticoBar() {
        function checkHora() {
            const ahora = new Date();
            if (ahora.getHours() === 21 && ahora.getMinutes() === 0) {
                generarPDFVentasHoyBar();
            }
        }
        setInterval(checkHora, 60000);
    }
    cargarDatosBar();
    actualizarTablaBar();
    actualizarSelectBar();
    mostrarAlertaStockBajoBar();
    programarPDFAutomaticoBar();
    </script>
</body>
</html>